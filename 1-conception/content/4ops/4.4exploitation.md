+++
title = "4.4 Exploitation"
date = 2024-05-16T18:01:19+02:00
weight = 40400
+++

Cette page décrit les tests d'une campagne de non-régression complète

{{< table_of_contents >}}

## 4.4.1 - Introduction
Cette page décrit les différentes commandes utiles pour l'exploitation de ce SI.

___
## 4.4.2 - Prérequis à l'installation
Les machines doivent toutes être des machines Ubuntu récentes (2023xx minimum).
Un compte disposant des droits SUDO doit exister (par exemple, _ubuntu_ dans le reste de la documentation)

___
## 4.4.3 - Commandes possibles

Détruire tout contenu PSL sur toutes les machines :
```ansible-playbook ansible/99_detruire.yml -i ansible/inventory/local -K --extra-vars "ansible_user=ubuntu"```

Créer tous les éléments de base nécessitant des droits SUDO sur toutes les machines :
```ansible-playbook ansible/01_preparer.yml -i ansible/inventory/local -K --extra-vars "ansible_user=ubuntu"```

Créer tous les éléments de base nécessitant des droits SUDO sur les machines associées à un applicatif (exemple _service-gateway_) :
```ansible-playbook ansible/01_preparer.yml -i ansible/inventory/local -K --extra-vars "ansible_user=ubuntu" --tags service-gateway```

Créer tous les éléments de base nécessitant des droits SUDO sur les machines d'une colonne précise (pour arrêter la moitée des machines) :
```ansible-playbook ansible/01_preparer.yml -i ansible/inventory/local -K --extra-vars "ansible_user=ubuntu" --limit machines_colonne_execution1```

Pour tout détruire et tout recréer :
```ansible-playbook ansible/99_detruire.yml ansible/01_preparer.yml -i ansible/inventory/local -K --extra-vars "ansible_user=ubuntu"```

Pour installer les éléments de base et configurations applicatives sur toutes les machines :
```ansible-playbook ansible/02_installer.yml -i ansible/inventory/local```

Pour déployer les applicatifs sur toutes les machines :
```ansible-playbook ansible/03_deployer.yml -i ansible/inventory/local```

Pour démarrer tous les applicatifs (pas _apache2_ qui nécessite des droits SUDO) sur toutes les machines :
```ansible-playbook ansible/04_demarrer.yml -i ansible/inventory/local```

Pour avoir le statut et la version de les applicatifs sur toutes les machines :
```ansible-playbook ansible/05_statuer.yml -i ansible/inventory/local```

Pour arrêter tous les applicatifs (pas _apache2_ qui nécessite des droits SUDO) sur toutes les machines :
```ansible-playbook ansible/06_arreter.yml -i ansible/inventory/local```

___
## 4.4.4 - Obtenir les versions des composants déployés

Depuis le navigateur, pour les applications WEB, il est possible d'obtenir quelques informations de version de chaque livrable depuis le fichier _git.json_ généré durant le build _Maven_. Ce fichier est disponible depuis l'URL _mademarche/etatcivil/git.json_ par exemple. Il contient, par exemple :
```
{
  "git.branch": "master",
  "git.build.time": "2024-05-16T08:34:27+0200",
  "git.build.version": "0.0.2-SNAPSHOT",
  "git.closest.tag.commit.count": "1121",
  "git.closest.tag.name": "0.0.1-RELEASE",
  "git.commit.id": "b506017a7957f279127140da3b74ef8ba59a81cd"
}
```
